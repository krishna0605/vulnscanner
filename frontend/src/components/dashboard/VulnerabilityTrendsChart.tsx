import React from 'react';
import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Legend
} from 'recharts';
import { Box, Typography, useTheme } from '@mui/material';

interface VulnerabilityData {
  date: string;
  critical: number;
  high: number;
  medium: number;
  low: number;
  total: number;
}

interface VulnerabilityTrendsChartProps {
  data: VulnerabilityData[];
  loading?: boolean;
  height?: number;
}

const VulnerabilityTrendsChart: React.FC<VulnerabilityTrendsChartProps> = ({
  data,
  loading = false,
  height = 300
}) => {
  const theme = useTheme();

  // Custom tooltip component
  const CustomTooltip = ({ active, payload, label }: any) => {
    if (active && payload && payload.length) {
      return (
        <Box
          sx={{
            backgroundColor: 'rgba(10, 22, 40, 0.95)',
            border: '1px solid rgba(74, 144, 226, 0.3)',
            borderRadius: 1,
            p: 1.5,
            backdropFilter: 'blur(10px)'
          }}
        >
          <Typography variant="body2" sx={{ color: '#fff', mb: 1 }}>
            {label}
          </Typography>
          {payload.map((entry: any, index: number) => (
            <Typography
              key={index}
              variant="body2"
              sx={{ color: entry.color, fontSize: '0.875rem' }}
            >
              {entry.name}: {entry.value}
            </Typography>
          ))}
        </Box>
      );
    }
    return null;
  };

  if (loading) {
    return (
      <Box
        sx={{
          height,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          backgroundColor: 'rgba(46, 46, 63, 0.1)',
          borderRadius: 1,
          position: 'relative',
          overflow: 'hidden'
        }}
      >
        <Box
          sx={{
            position: 'absolute',
            top: 0,
            left: '-100%',
            width: '100%',
            height: '100%',
            background: 'linear-gradient(90deg, transparent, rgba(74, 144, 226, 0.1), transparent)',
            animation: 'shimmer 1.5s infinite'
          }}
        />
        <Typography variant="body2" sx={{ color: 'text.secondary' }}>
          Loading chart data...
        </Typography>
      </Box>
    );
  }

  return (
    <Box sx={{ width: '100%', height }}>
      <ResponsiveContainer width="100%" height="100%">
        <LineChart
          data={data}
          margin={{
            top: 20,
            right: 30,
            left: 20,
            bottom: 20,
          }}
        >
          <CartesianGrid 
            strokeDasharray="3 3" 
            stroke="rgba(74, 144, 226, 0.1)"
            vertical={false}
          />
          <XAxis
            dataKey="date"
            axisLine={false}
            tickLine={false}
            tick={{ fill: theme.palette.text.secondary, fontSize: 12 }}
            tickFormatter={(value) => {
              const date = new Date(value);
              return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }}
          />
          <YAxis
            axisLine={false}
            tickLine={false}
            tick={{ fill: theme.palette.text.secondary, fontSize: 12 }}
          />
          <Tooltip content={<CustomTooltip />} />
          <Legend
            wrapperStyle={{
              paddingTop: '20px',
              fontSize: '12px'
            }}
          />
          <Line
            type="monotone"
            dataKey="critical"
            stroke="#FF4C4C"
            strokeWidth={2}
            dot={{ fill: '#FF4C4C', strokeWidth: 0, r: 4 }}
            activeDot={{ r: 6, stroke: '#FF4C4C', strokeWidth: 2, fill: '#FF4C4C' }}
            name="Critical"
          />
          <Line
            type="monotone"
            dataKey="high"
            stroke="#FF8533"
            strokeWidth={2}
            dot={{ fill: '#FF8533', strokeWidth: 0, r: 4 }}
            activeDot={{ r: 6, stroke: '#FF8533', strokeWidth: 2, fill: '#FF8533' }}
            name="High"
          />
          <Line
            type="monotone"
            dataKey="medium"
            stroke="#FFB833"
            strokeWidth={2}
            dot={{ fill: '#FFB833', strokeWidth: 0, r: 4 }}
            activeDot={{ r: 6, stroke: '#FFB833', strokeWidth: 2, fill: '#FFB833' }}
            name="Medium"
          />
          <Line
            type="monotone"
            dataKey="low"
            stroke="#4AE54A"
            strokeWidth={2}
            dot={{ fill: '#4AE54A', strokeWidth: 0, r: 4 }}
            activeDot={{ r: 6, stroke: '#4AE54A', strokeWidth: 2, fill: '#4AE54A' }}
            name="Low"
          />
        </LineChart>
      </ResponsiveContainer>
    </Box>
  );
};

export default VulnerabilityTrendsChart;
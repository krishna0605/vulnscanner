# Kubernetes Secrets for Enhanced Vulnerability Scanner
# NOTE: This is a template file. Replace all placeholder values with actual secrets.
# Use kubectl create secret or external secret management tools in production.

apiVersion: v1
kind: Secret
metadata:
  name: vulscanner-secrets
  namespace: vulscanner
  labels:
    app.kubernetes.io/name: enhanced-vulnerability-scanner
    app.kubernetes.io/component: secrets
    app.kubernetes.io/part-of: vulscanner
type: Opaque
data:
  # Database Credentials (base64 encoded)
  POSTGRES_PASSWORD: <BASE64_ENCODED_PASSWORD>
  DATABASE_URL: <BASE64_ENCODED_DATABASE_URL>
  
  # Redis Credentials
  REDIS_PASSWORD: <BASE64_ENCODED_REDIS_PASSWORD>
  REDIS_URL: <BASE64_ENCODED_REDIS_URL>
  
  # RabbitMQ Credentials
  RABBITMQ_PASSWORD: <BASE64_ENCODED_RABBITMQ_PASSWORD>
  CELERY_BROKER_URL: <BASE64_ENCODED_CELERY_BROKER_URL>
  
  # Application Secrets
  SECRET_KEY: <BASE64_ENCODED_SECRET_KEY>
  JWT_SECRET_KEY: <BASE64_ENCODED_JWT_SECRET_KEY>
  
  # Supabase Configuration
  SUPABASE_URL: <BASE64_ENCODED_SUPABASE_URL>
  SUPABASE_ANON_KEY: <BASE64_ENCODED_SUPABASE_ANON_KEY>
  SUPABASE_SERVICE_ROLE_KEY: <BASE64_ENCODED_SUPABASE_SERVICE_ROLE_KEY>
  
  # Monitoring Credentials
  GRAFANA_ADMIN_PASSWORD: <BASE64_ENCODED_GRAFANA_PASSWORD>

---
apiVersion: v1
kind: Secret
metadata:
  name: vulscanner-tls
  namespace: vulscanner
  labels:
    app.kubernetes.io/name: enhanced-vulnerability-scanner
    app.kubernetes.io/component: tls
    app.kubernetes.io/part-of: vulscanner
type: kubernetes.io/tls
data:
  tls.crt: <BASE64_ENCODED_TLS_CERTIFICATE>
  tls.key: <BASE64_ENCODED_TLS_PRIVATE_KEY>

---
# Example of how to create secrets using kubectl:
# 
# Database Password:
# kubectl create secret generic vulscanner-secrets \
#   --from-literal=POSTGRES_PASSWORD='your-secure-password' \
#   --from-literal=DATABASE_URL='postgresql+asyncpg://vulscanner:password@postgres:5432/vulscanner' \
#   --namespace=vulscanner
#
# TLS Certificate:
# kubectl create secret tls vulscanner-tls \
#   --cert=path/to/tls.crt \
#   --key=path/to/tls.key \
#   --namespace=vulscanner
#
# Or use external secret management:
# - AWS Secrets Manager with External Secrets Operator
# - HashiCorp Vault with Vault Agent
# - Azure Key Vault with CSI Secret Store Driver
# - Google Secret Manager with Secret Manager CSI Driver

---
# External Secrets Operator Example (if using AWS Secrets Manager)
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vulscanner-secret-store
  namespace: vulscanner
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-west-2
      auth:
        jwt:
          serviceAccountRef:
            name: vulscanner-external-secrets-sa

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: vulscanner-external-secrets
  namespace: vulscanner
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vulscanner-secret-store
    kind: SecretStore
  target:
    name: vulscanner-secrets
    creationPolicy: Owner
  data:
  - secretKey: POSTGRES_PASSWORD
    remoteRef:
      key: vulscanner/database
      property: password
  - secretKey: SECRET_KEY
    remoteRef:
      key: vulscanner/app
      property: secret_key
  - secretKey: SUPABASE_SERVICE_ROLE_KEY
    remoteRef:
      key: vulscanner/supabase
      property: service_role_key